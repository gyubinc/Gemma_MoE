# Qwen-MoE λ°μ΄ν„°μ…‹ λ¶„μ„ λ³΄κ³ μ„

## π“ μ „μ²΄ μ”μ•½

### λ°μ΄ν„°μ…‹ ν„ν™©
- **μ΄ λ„λ©”μΈ μ**: 3κ° (Medical, Law, Math)
- **μ„±κ³µμ μΌλ΅ κ²€μ¦λ λ„λ©”μΈ**: 3κ° (100%)
- **μ΄ μƒν” μ**: 282,952κ°
- **νΈν™μ„± μƒνƒ**: β… λ¨λ“  λ°μ΄ν„°μ…‹μ΄ μ™„μ „ νΈν™λ¨

### λ„λ©”μΈλ³„ μƒμ„Έ μ •λ³΄

| λ„λ©”μΈ | λ°μ΄ν„°μ…‹ | μƒν” μ | ν¬λ§· | μ–Έμ–΄ | μƒνƒ |
|--------|----------|---------|------|------|------|
| Medical | MedMCQA | 193,155 | multiple_choice_qa | English | β… |
| Law | CaseHOLD | 52,500 | legal_case_analysis | English | β… |
| Math | MathQA | 37,297 | multiple_choice_qa | English | β… |

## π” λ°μ΄ν„°μ…‹λ³„ μƒμ„Έ λ¶„μ„

### 1. Medical Domain (MedMCQA)
- **νμΌ κµ¬μ΅°**: `medmcqa_train.json`, `medmcqa_validation.json`, `medmcqa_test.json`
- **ν›λ ¨ μƒν”**: 182,822κ°
- **κ²€μ¦ μƒν”**: 4,183κ°
- **ν…μ¤νΈ μƒν”**: 6,150κ°
- **JSON κµ¬μ΅°**:
  ```json
  {
    "id": "uuid",
    "question": "μ§λ¬Έ ν…μ¤νΈ",
    "options": ["μ„ νƒμ§€1", "μ„ νƒμ§€2", "μ„ νƒμ§€3", "μ„ νƒμ§€4"],
    "correct_option": 2,
    "correct_answer": "μ •λ‹µ ν…μ¤νΈ",
    "formatted_question": "ν¬λ§·λ μ§λ¬Έ",
    "formatted_answer": "ν¬λ§·λ λ‹µλ³€",
    "subject": "κ³Όλ©",
    "topic": "μ£Όμ ",
    "explanation": "ν•΄μ„¤"
  }
  ```

### 2. Law Domain (CaseHOLD)
- **νμΌ κµ¬μ΅°**: `case_hold_train.json`, `case_hold_validation.json`, `case_hold_test.json`
- **ν›λ ¨ μƒν”**: 45,000κ°
- **κ²€μ¦ μƒν”**: 3,900κ°
- **ν…μ¤νΈ μƒν”**: 3,600κ°
- **JSON κµ¬μ΅°**:
  ```json
  {
    "context": "λ²•μ  μ‚¬λ΅€ λ§¥λ½",
    "endings": ["κ²°λ΅ 1", "κ²°λ΅ 2", "κ²°λ΅ 3", "κ²°λ΅ 4", "κ²°λ΅ 5"],
    "correct_ending_idx": 0,
    "correct_ending": "μ •λ‹µ κ²°λ΅ ",
    "formatted_question": "ν¬λ§·λ μ§λ¬Έ",
    "formatted_answer": "ν¬λ§·λ λ‹µλ³€"
  }
  ```

### 3. Math Domain (MathQA)
- **νμΌ κµ¬μ΅°**: `mathqa_train.json`, `mathqa_validation.json`, `mathqa_test.json`
- **ν›λ ¨ μƒν”**: 29,837κ°
- **κ²€μ¦ μƒν”**: 4,475κ°
- **ν…μ¤νΈ μƒν”**: 2,985κ°
- **JSON κµ¬μ΅°**:
  ```json
  {
    "id": "uuid",
    "question": "μν•™ λ¬Έμ ",
    "options": ["μ„ νƒμ§€1", "μ„ νƒμ§€2", "μ„ νƒμ§€3", "μ„ νƒμ§€4", "μ„ νƒμ§€5"],
    "correct_option": 0,
    "correct_answer": "μ •λ‹µ",
    "formatted_question": "ν¬λ§·λ μ§λ¬Έ",
    "formatted_answer": "ν¬λ§·λ λ‹µλ³€",
    "explanation": "ν•΄μ„¤",
    "category": "μΉ΄ν…κ³ λ¦¬",
    "annotated_formula": "μ£Όμ„ κ³µμ‹",
    "linear_formula": "μ„ ν• κ³µμ‹"
  }
  ```

## β… νΈν™μ„± κ²€μ¦ κ²°κ³Ό

### 1. νμΌ κµ¬μ΅° νΈν™μ„±
- β… λ¨λ“  λ„λ©”μΈμ—μ„ ν•„μ νμΌ μ΅΄μ¬
- β… JSON ν¬λ§· μΌκ΄€μ„± μ μ§€
- β… μƒν” μ μΌμΉ (summary.jsonκ³Ό μ‹¤μ  νμΌ)

### 2. λ°μ΄ν„° ν¬λ§· νΈν™μ„±
- β… λ¨λ“  λ„λ©”μΈμ΄ λ‹¤μ§€μ„ λ‹¤ ν•μ‹ μ§€μ›
- β… Medical/Math: 4-5κ° μ„ νƒμ§€ (A, B, C, D, E)
- β… Law: 5κ° μ„ νƒμ§€ (A, B, C, D, E)
- β… μΌκ΄€λ JSON κµ¬μ΅°

### 3. ν‰κ°€ ν•¨μ νΈν™μ„±
- β… Medical/Law: λ‹¤μ§€μ„ λ‹¤ μ •λ‹µ μ¶”μ¶ (A, B, C, D, E)
- β… Math: μμΉ μ •λ‹µ μ¶”μ¶ (λ‹¨κ³„λ³„ ν•΄κ²° κ³Όμ •μ—μ„ μµμΆ… λ‹µ)
- β… ν‰κ°€ μ •ν™•λ„: Medical 100%, Law 100%, Math 94.12%

## π― ν‰κ°€ λ°©μ‹ λ¶„μ„

### λ‹¤μ§€μ„ λ‹¤ ν‰κ°€ μ „λµ
1. **Medical/Law λ„λ©”μΈ**:
   - λ¨λΈ μ¶λ ¥μ—μ„ A, B, C, D, E μ„ νƒμ§€ μ¶”μ¶
   - μ •κ·ν‘ν„μ‹μ„ ν†µν• ν¨ν„΄ λ§¤μΉ­
   - μ •ν™•ν• λ¬Έμμ—΄ λ§¤μΉ­μΌλ΅ μ •ν™•λ„ κ³„μ‚°

2. **Math λ„λ©”μΈ**:
   - λ‹¨κ³„λ³„ ν•΄κ²° κ³Όμ •μ—μ„ μµμΆ… μμΉ λ‹µ μ¶”μ¶
   - "####", "Answer:", "The answer is" λ“± ν¨ν„΄ μΈμ‹
   - λ§μ§€λ§‰ μμΉλ¥Ό μµμΆ… λ‹µμΌλ΅ κ°„μ£Ό

### ν‰κ°€ ν•¨μ μ„±λ¥
- **Medical**: 100% μ •ν™•λ„ (14/14 ν…μ¤νΈ μΌ€μ΄μ¤)
- **Law**: 100% μ •ν™•λ„ (11/11 ν…μ¤νΈ μΌ€μ΄μ¤)
- **Math**: 94.12% μ •ν™•λ„ (16/17 ν…μ¤νΈ μΌ€μ΄μ¤)

## π’΅ κ°μ„  κ¶μ¥μ‚¬ν•­

### 1. ν¬λ§· ν‘μ¤€ν™”
- Law λ„λ©”μΈμ `legal_case_analysis` ν¬λ§·μ„ `multiple_choice_qa`λ΅ ν†µμΌ κ³ λ ¤
- λ¨λ“  λ„λ©”μΈμ—μ„ λ™μΌν• ν‰κ°€ λ°©μ‹ μ μ©

### 2. μƒν” ν¬κΈ° κ· ν•
- Medical (193K) vs Math (37K): μ•½ 5.2λ°° μ°¨μ΄
- ν›λ ¨ μ‹ μƒν”λ§ μ „λµμΌλ΅ κ· ν• λ§μ¶”κΈ° κ¶μ¥

### 3. Math ν‰κ°€ κ°μ„ 
- Math λ„λ©”μΈμ—μ„ 94.12% μ •ν™•λ„
- λ³µμ΅ν• μν•™ ν‘ν„μ‹ μ²λ¦¬ κ°μ„  ν•„μ”

## π”§ κΈ°μ μ  κµ¬ν„ μ‚¬ν•­

### λ°μ΄ν„° λ΅λ”©
```python
# dataset.pyμ—μ„ λ„λ©”μΈλ³„ λ΅λ”© ν•¨μ
def _load_medical_data()  # MedMCQA λ΅λ”©
def _load_law_data()      # CaseHOLD λ΅λ”©  
def _load_math_data()     # MathQA λ΅λ”©
```

### ν‰κ°€ ν•¨μ
```python
# utils.pyμ—μ„ λ„λ©”μΈλ³„ ν‰κ°€
def clean_multiple_choice_prediction()  # Medical/Law
def extract_math_answer()              # Math
def evaluate_domain_model()            # ν†µν•© ν‰κ°€
```

### ν¬λ§· λ³€ν™
- MathQA: CSV β†’ JSON λ³€ν™ μ™„λ£
- λ¨λ“  λ„λ©”μΈ: ν†µμΌλ JSON κµ¬μ΅°
- summary.json: ν‘μ¤€ν™”λ λ©”νƒ€λ°μ΄ν„°

## π“ κ²°λ΅ 

### νΈν™μ„± μƒνƒ: β… μ™„μ „ νΈν™
- λ¨λ“  λ°μ΄ν„°μ…‹μ΄ Qwen-MoE ν”„λ΅μ νΈμ™€ μ™„μ „ νΈν™
- ν‰κ°€ ν•¨μλ“¤μ΄ μ •ν™•ν•κ² μ‘λ™
- λ°μ΄ν„° λ΅λ”© λ° μ²λ¦¬ νμ΄ν”„λΌμΈ μ¤€λΉ„ μ™„λ£

### λ‹¤μ λ‹¨κ³„
1. Medical λ„λ©”μΈ LoRA ν›λ ¨ μ‹¤ν–‰
2. Law, Math λ„λ©”μΈ μμ°¨ ν›λ ¨
3. MoE μ•„ν‚¤ν…μ² κµ¬μ„±
4. Router ν›λ ¨ λ° μµμΆ… ν‰κ°€

### κ¶μ¥ μ‹¤ν–‰ λ…λ Ήμ–΄
```bash
# Medical λ„λ©”μΈ ν›λ ¨
conda activate gyubin
cd Qwen_MoE
export CUDA_VISIBLE_DEVICES=6
python run_medical_experiment.py --config configs/medical_optimized_config.yaml
```

---
**μƒμ„±μΌ**: 2024λ…„ 8μ›” 22μΌ  
**κ²€μ¦ μ™„λ£**: β… λ¨λ“  λ°μ΄ν„°μ…‹ νΈν™μ„± ν™•μΈλ¨  
**μƒνƒ**: ν›λ ¨ μ¤€λΉ„ μ™„λ£
